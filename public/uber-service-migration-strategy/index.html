<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=58150&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Uber&#39;s service migration strategy circa 2014. | Drafting Strategy</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="In early 2014, I joined as an engineering manager for Uber&rsquo;s Infrastructure team. We were responsible for a wide number of things, including provisioning new services. While the overall team I led grew significantly over time, the subset working on service provisioning never grew beyond four engineers.
Those four engineers successfully migrated 1,000&#43; services onto a new, future-proofed service platform. More importantly, they did it while absorbing the majority, although certainly not the entirety, of the migration workload onto that small team rather than spreading it across the 2,000&#43; engineers working at Uber at the time.">
    <meta name="generator" content="Hugo 0.128.2">
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    <meta name="author" content="map[name:Will Larson]">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



  
    <link rel="stylesheet" href="/static/pygments.css">
  


    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:58150/uber-service-migration-strategy/">
    

    <meta property="og:url" content="http://localhost:58150/uber-service-migration-strategy/">
  <meta property="og:site_name" content="Drafting Strategy">
  <meta property="og:title" content="Uber&#39;s service migration strategy circa 2014.">
  <meta property="og:description" content="In early 2014, I joined as an engineering manager for Uber’s Infrastructure team. We were responsible for a wide number of things, including provisioning new services. While the overall team I led grew significantly over time, the subset working on service provisioning never grew beyond four engineers.
Those four engineers successfully migrated 1,000&#43; services onto a new, future-proofed service platform. More importantly, they did it while absorbing the majority, although certainly not the entirety, of the migration workload onto that small team rather than spreading it across the 2,000&#43; engineers working at Uber at the time.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="strategies">
    <meta property="article:published_time" content="2025-01-09T06:00:00-07:00">
    <meta property="article:modified_time" content="2025-01-09T06:00:00-07:00">
    <meta property="article:tag" content="Strategy">
    <meta property="article:tag" content="Eng-Strategy-Book">
    <meta property="og:image" content="http://localhost:58150/static/author.png">

  <meta itemprop="name" content="Uber&#39;s service migration strategy circa 2014.">
  <meta itemprop="description" content="In early 2014, I joined as an engineering manager for Uber’s Infrastructure team. We were responsible for a wide number of things, including provisioning new services. While the overall team I led grew significantly over time, the subset working on service provisioning never grew beyond four engineers.
Those four engineers successfully migrated 1,000&#43; services onto a new, future-proofed service platform. More importantly, they did it while absorbing the majority, although certainly not the entirety, of the migration workload onto that small team rather than spreading it across the 2,000&#43; engineers working at Uber at the time.">
  <meta itemprop="datePublished" content="2025-01-09T06:00:00-07:00">
  <meta itemprop="dateModified" content="2025-01-09T06:00:00-07:00">
  <meta itemprop="wordCount" content="2088">
  <meta itemprop="image" content="http://localhost:58150/static/author.png">
  <meta itemprop="keywords" content="Strategy,Eng-Strategy-Book">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:58150/static/author.png">
  <meta name="twitter:title" content="Uber&#39;s service migration strategy circa 2014.">
  <meta name="twitter:description" content="In early 2014, I joined as an engineering manager for Uber’s Infrastructure team. We were responsible for a wide number of things, including provisioning new services. While the overall team I led grew significantly over time, the subset working on service provisioning never grew beyond four engineers.
Those four engineers successfully migrated 1,000&#43; services onto a new, future-proofed service platform. More importantly, they did it while absorbing the majority, although certainly not the entirety, of the migration workload onto that small team rather than spreading it across the 2,000&#43; engineers working at Uber at the time.">

	

  </head><body class="ma0 avenir bg-white development">

    
   
  <header>
  <div class="bg-white">
    <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 no-underline black-90 dib">
      
        Drafting Strategy
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="no-underline black-90" href="/about" title="About page">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="no-underline black-90" href="" title=" page">
              
            </a>
          </li>
          
        </ul>
      
      















    </div>
  </div>
  
    
</nav>

  </div>
</header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      
      
      <h1 class="f1 athelas mt3 mb3">Uber&#39;s service migration strategy circa 2014.</h1>
      
      

      
      

    </header>
    <div class="nested-copy-line-height lh-copy serif f5 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>In early 2014, I joined as an engineering manager for Uber&rsquo;s Infrastructure team.
We were responsible for a wide number of things, including provisioning new services.
While the overall team I led grew significantly over time,
the subset working on service provisioning never
grew beyond four engineers.</p>
<p>Those four engineers successfully migrated 1,000+ services onto a new, future-proofed service platform.
More importantly, they did it while absorbing the majority, although certainly not the entirety, of the migration workload
onto that small team rather than spreading it across the 2,000+ engineers working at Uber at the time.
Their strategy serves as an interesting case study of how a team can drive strategy, even without any executive sponsor,
by focusing on solving a pressing user problem, and providing effective ergonomics while doing so.</p>
<h2 id="reading-this-document">Reading this document</h2>
<p>To apply this strategy, start at the top with <em>Policy</em>. To understand the thinking behind this strategy, read sections in reserve order, starting with <em>Explore</em>, then <em>Diagnose</em> and so on.
Relative to the default structure, this document one tweak, folding the <em>Operation</em> section in with  <em>Policy</em>.</p>
<p>More detail on this structure in <a href="/readable-engineering-strategy-documents">Making a readable Engineering Strategy document</a>.</p>
<h2 id="policy--operation">Policy &amp; Operation</h2>
<p>We&rsquo;ve adopted these guiding principles for
extending Uber&rsquo;s service platform:</p>
<ul>
<li>
<p><strong>Constrain manual provisioning allocation to maximize investment in self-service provisioning.</strong>
The service provisioning team will maintain a fixed allocation of one full time engineer on manual service provisioning tasks.
We will move the remaining engineers to work on automation to speed up future service provisioning.
This will degrade manual provisioning in the short term, but the alternative is
permanently degrading provisioning by the influx of new service requests from newly hired product engineers.</p>
</li>
<li>
<p><strong>Self-service must be safely usable by a new hire without Uber context.</strong>
It is possible today to make a Puppet or Clusto change while provisioning a new service that
negatively impacts the production environment. This must not be true in any self-service solution.</p>
</li>
<li>
<p><strong>Move to structured requests, and out of tickets.</strong>
Missing or incorrect information in provisioning requests create significant delays in provisioning.
Further, collecting this information is the first step of moving to a self-service process.
As such, we can get paid twice by reducing errors in manual provisioning while also
creating the interface for self-service workflows.</p>
</li>
<li>
<p><strong>Prefer initializing new services with good defaults rather than requiring user input.</strong>
Most new services are provisioned for new projects with strong timeline pressure
but little certainty on their long-term requirements.
These users cannot accurately predict their future needs, and expecting them to do so
creates significant friction.</p>
<p>Instead, the provisioning framework should suggest good defaults,
and make it easy to change the settings later when users have more clarity.
The gate from development environment to production environment is a particularly
effective one for ensuring settings are refreshed.</p>
</li>
</ul>
<p>We are materializing those principles into this
sequenced set of tasks:</p>
<ol>
<li>
<p>Create an internal tool that coordinates service provisioning,
replacing the process where teams request new services via Phabricator tickets.
This new tool will maintain a schema of required fields that must be supplied,
with the aim of eliminating the majority of back and forth between teams during service provisioning.</p>
<p>In addition to capturing necessary data, this will also serve as our interface
for automating various steps in provisioning without requiring future changes in
the workflow to request service provisioning.</p>
</li>
<li>
<p>Extend the internal tool will generate Puppet scaffolding for new services,
reducing the potential for errors in two ways. First, the data supplied in the service provisioning
request can be directly included into the rendered template.
Second, this will eliminate most human tweaking of templates where typo&rsquo;s can create issues.</p>
</li>
<li>
<p>Port allocation is a particularly high-risk element of provisioning, as reusing a port can
break routing to an existing production service.
As such, this will be the first area we fully automate, with the provisioning service
supplying the allocated port rather than requiring requesting teams to provide an already allocated port.</p>
<p>Doing this will require moving the port registry out of a Phabricator wiki page
and into a database, which will allow us to guard access with a variety of checks.</p>
</li>
<li>
<p>Manual assignment of new services to servers often leads to new services being allocated
to already heavily utilized servers. We will replace the manual assignment with an automated system, and do so
with the intention of migrating to the Mesos/Aurora cluster once it is available for production workloads.</p>
</li>
</ol>
<p>Each week, we&rsquo;ll review the size of the service provisioning queue,
along with the service provisioning time to assess whether the
strategy is working or needs to be revised.</p>
<div class="bg-light-gray br4 ph3 pv1">
<p><strong>Prolonged strategy testing</strong></p>
<p>Although I didn&rsquo;t have a name for this practice
in 2014 when we created and implemented this strategy,
the preceding paragraph captures an important truth
of team-led bottom-up strategy: the entire
strategy was implemented in a prolonged
<a href="/testing-strategy-iterative-refinement/">strategy testing</a> phase.</p>
<p>This is an important truth of all low-attitude, bottom-up strategy:
because you don&rsquo;t have the authority to mandate compliance.
An executive&rsquo;s high-altitude strategy can be enforced despite
not working due to their organizational authority, but
a team&rsquo;s strategy will only endure while it remains effective.</p>
</div>
<h2 id="refine">Refine</h2>
<p>In order to refine our diagnosis, we&rsquo;ve <a href="/uber-service-onboarding-model/">created a systems model for service onboarding</a>.
This will allow us to simulate a variety of different approaches to our problem,
and determine which approach, or combination of approaches, will be most effective.</p>
<p><img src="/static/blog/strategy/uber-provis-model-errors.png" alt="A systems model of provisioning services at Uber circa 2014."></p>
<p>As we exercised the model, it became clear that:</p>
<ol>
<li>we are increasingly falling behind,</li>
<li>hiring onto the service provisioning team is not a viable solution, and</li>
<li>moving to a self-service approach is our only option.</li>
</ol>
<p>While the model writeup justifies each of those statements in more detail,
we&rsquo;ll include two charts here. The first chart shows the status quo,
where new service provisioning requests, labeled as <code>Initial RequestedServices</code>,  quickly accumulate into a backlog.</p>
<p><img src="/static/blog/strategy/uber-model-diag-1.png" alt="Initial diagram of Uber service provisioning model without error states."></p>
<p>Second, we have a chart comparing the outcomes between the current status quo and a self-service approach.</p>
<p><img src="/static/blog/strategy/uber-model-chart-self-service.png" alt="Chart showing impact of self-service provisioning on provisioning rate."></p>
<p>In that chart, you can see that the service provisioning backlog in the self-service model remains steady,
as represented by the <code>SelfService RequestedServices</code> line. Of the various attempts to find a solution,
none of the others showed promise, including eliminating all errors in provisioning and increasing the team&rsquo;s
capacity by 500%.</p>
<h2 id="diagnose">Diagnose</h2>
<p>We&rsquo;ve diagnosed the current state of service provisioning at Uber as:</p>
<ul>
<li>
<p>Many product engineering teams are aiming to leave the centralized monolith,
which is generating two to three service provisioning requests each week.
We expect this rate to increase roughly linearly with the size of the product engineering
organization.</p>
<p>Even if we disagree with this shift to additional services,
there&rsquo;s no team responsible for maintaining the extensibility of the monolith,
and working in the monolith is the number one source of developer frustration,
so we don&rsquo;t have a practical counter proposal to offer engineers other than
provisioning a new service.</p>
</li>
<li>
<p>The engineering organization is doubling every six months.
Consequently, a year from now, we expect eight to twelve service provisioning requests every week.</p>
</li>
<li>
<p>Within infrastructure engineering, there is a team of four engineers responsible for service provisioning today.
While our organization is growing at a similar rate as product engineering,
none of that additional headcount is being allocated directly to the team working on service provisioning.
We do not anticipate this changing.</p>
<p>Some additional headcount is being allocated to Service Reliability Engineers (SREs) who
can take on the most nuanced, complicated service provisioning work.
However, their bandwidth is already heavily constrained across many tasks,
so relying on SRES is an insufficient solution.</p>
</li>
<li>
<p>The queue for service provisioning is already increasing in size as things are today.
Barring some change, many services will not be provisioned in a timely fashion.</p>
</li>
<li>
<p>Today, provisioning a new service takes about a week, with numerous round trips
between the requesting team and the provisioning team.
Missing and incorrect information between teams is the largest source of
delay in provisioning services.</p>
<p>If the provisioning team has all the necessary information, and it&rsquo;s accurate,
then a new service can be provisioned in about three to four hours of work across
configuration in Puppet, metadata in Clusto, allocating ports, assigning the service to servers, and so on.</p>
</li>
<li>
<p>There are few safeguards on port allocation, server assignment and so on.
It is easy to inadvertently cause a production outage during service provisioning
unless done with attention to detail.</p>
<p>Given our rate of hiring, training the engineering organization to use this unsafe toolchain
is an impractical solution: even if we train the entire organization perfectly today,
there will be just as many untrained individuals in six months.
Further, product engineering leadership has no interest in their team
being diverted to service provisioning training.</p>
</li>
<li>
<p>It&rsquo;s widely agreed across the infrastructure engineering team that
essentially every component of service provisioning should be replaced as soon as possible,
but there is no concrete plan to replace any of the core components.
Further, there is no team accountable for replacing these components,
which means the service provisioning team will either need to
work around the current tooling or replace that tooling ourselves.</p>
</li>
<li>
<p>It&rsquo;s urgent to unblock development of new services, but moving those new services
to production is rarely urgent, and occurs after a long internal development period.
Evidence of this is that requests to provision a new service generally come with significant urgency
and internal escalations to management. After the service is provisioned for development,
there are relatively few urgent escalations other than one-off requests for increased
production capacity during incidents.</p>
</li>
<li>
<p>Another team within infrastructure is actively exploring adoption of Mesos and Aurora,
but there&rsquo;s no concrete timeline for when this might be available for our usage.
Until they commit to supporting our workloads, we&rsquo;ll need to find an alternative
solution.</p>
</li>
</ul>
<h2 id="explore">Explore</h2>
<p>Uber&rsquo;s server and service infrastructure today is composed of a handful of pieces.
First, we run servers on-prem within a handful of colocations.
Second, we describe each server in Puppet manifests to support repeatable provisioning of servers.
Finally, we manage fleet and server metadata in a tool named Clusto, originally created by Digg,
which allows us to populate Puppet manifests with server and cluster appropriate metadata during provisioning.
In general, we agree that our current infrastructure is nearing its end of lifespan,
but it&rsquo;s less obvious what the appropriate replacements are for each piece.</p>
<p>There&rsquo;s significant internal opposition to running in the cloud,
up to and including our CEO, so we don&rsquo;t believe that will change
in the foreseeable future. We do however believe there&rsquo;s opportunity to
change our service definitions from Puppet to something along the lines of Docker,
and to change our metadata mechanism towards a more purpose-built solution
like Mesos/Aurora or Kubernetes.</p>
<p>As a starting point, we find it valuable to read
<a href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/43438.pdf">Large-scale cluster management at Google with Borg</a>
which informed some elements of the approach to Kubernetes,
and
<a href="https://people.eecs.berkeley.edu/~alig/papers/mesos.pdf">Mesos: A Platform for Fine-Grained Resource Sharing in the Data Center</a>
which describes the Mesos/Aurora approach.</p>
<div class="bg-light-gray br4 ph3 pv1">
<p>If you&rsquo;re wondering why there&rsquo;s no mention of
<a href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/44843.pdf">Borg, Omega, and Kubernetes</a>,
it&rsquo;s because it wasn&rsquo;t published until 2016, a year after this strategy was developed.</p>
</div>
<p>Within Uber, we have a number of ex-Twitter engineers who can speak with confidence to their experience
operating with Mesos/Aurora at Twitter. We have been unable to find anyone to speak with that has
production Kubernetes experience operating a comparably large fleet of 10,000+ servers, although
presumably someone is operating&ndash;or close to operating&ndash;Kuberenetes at that scale.</p>
<p>Our general belief of the evolution of the ecosystem at the time
is <a href="/wardley-compute-ecosystem/">described in this Wardley mapping exercise on service orchestration (2014)</a>.</p>
<p><img src="/static/blog/strategy/wardley-compute-v2.png" alt="Wardley map of evolution of service orchestration in 2014"></p>
<p>One of the unknowns today is how the evolution of Mesos/Aurora and Kubernetes will look in the future.
Kubernetes seems promising with Google&rsquo;s backing, but there are few if any meaningful production deployments today.
Mesos/Aurora has more community support and more production deployments, but the absolute number of deployments
remains quite small, and there is no large-scale industry backer outside of Twitter.</p>
<p>Even further out, there&rsquo;s considerable excitement around &ldquo;serverless&rdquo; frameworks,
which seem like a likely future evolution, but canvassing the industry and our networks
we&rsquo;ve simply been unable to find enough real-world usage to make an active push towards
this destination today.</p>
<div class="bg-light-gray br4 ph3 pv1">
<p><a href="/wardley-mapping/">Wardley mapping</a> is introduced as one of the techniques
for <a href="/refining-eng-strategy/">strategy refinement</a>, but it can also be a useful
technique for exploring an dynamic ecosystem like service orchestration in 2014.</p>
<p>Assembling each strategy requires exercising judgment on how to compile the pieces
together most usefully, and in this case I found that the map fits most naturally
with the rest of exploration rather than in the more operationally-focused refinement
section.</p>
</div><div class="mt4">
        <hr>
        
        <p class="f5"><span class="b mb3">Next chapter: </span> <a href="/uber-service-onboarding-model/">Service onboarding model for Uber (2014).</a></p>
        
        
        <p class="f5"><span class="b mb3">Previous chapter: </span> <a href="/more-ways-to-refine-strategy/">More ways to refine engineering strategy.</a></p>
                
      </div>
      
      <div class="bg-light-gray br4 ph3 pv1">
        <p class="tracked">First published at <a href="https://lethain.com/uber-service-migration-strategy/">lethain.com/uber-service-migration-strategy/</a></p>      
      </div>
      

      <div class="mt6 instapaper_ignoref">
      
      </div>
    </div>

    <aside class="w-30-l mt1-l"><div class="bg-light-gray pa3 cf">
  <p class="f5 mb3">
    Hi folks. I'm <a href="https://lethain.com/about">Will Larson</a>,
    and this is my new book on engineering strategy, <em><a href="https://draftingstrategy.com/">Drafting Strategy</a></em>.
  </p>

  <p>
    I also wrote

    <em><a href="https://www.amazon.com/Elegant-Puzzle-Systems-Engineering-Management/dp/1732265186">An Elegant Puzzle</a></em>,
    <em><a href="https://staffeng.com/book">Staff Engineer</a></em>, and
      <em><a href="https://www.oreilly.com/library/view/the-engineering-executives/9781098149475/">The Engineering Executive's Primer</a></em>.
  </p>

  <p class="cf">
    <div class="fl w-third">
      <a href="https://www.amazon.com/Elegant-Puzzle-Systems-Engineering-Management/dp/1732265186">
        <img src="/static/aep-small-lq.jpg">
      </a>
    </div>
    <div class="fl w-third">    
      <a href="https://staffeng.com/book">
        <img src="/static/StaffEngBookMed.jpg">
      </a>
    </div>
    <div class="fl w-third">
      <a href="https://www.oreilly.com/library/view/the-engineering-executives/9781098149475/">
        <img src="/static/primer-cover-small.jpg">
      </a>
    </div>    
  </p>
</div>

<div class="bg-light-gray ph3 cf">
  <p class="f5 mb3">
    For updates on this project, join <em>Irrational Exuberance</em>'s
    <a href="/newsletter/">weekly newsletter</a>.
  </p>
</div>


<div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
  
    <p class="f5"><span class="b mb3">Next chapter</span></p>
    <p class="f5"><a href="/uber-service-onboarding-model/">Service onboarding model for Uber (2014).</a></p>
    
    
  
    <p class="f5"><span class="b mb3">Previous chapter</span></p>
    <p class="f5"><a href="/more-ways-to-refine-strategy/">More ways to refine engineering strategy.</a></p>
  
  <p class="f5 b mb3">Table of Contents</p>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#reading-this-document">Reading this document</a></li>
    <li><a href="#policy--operation">Policy &amp; Operation</a></li>
    <li><a href="#refine">Refine</a></li>
    <li><a href="#diagnose">Diagnose</a></li>
    <li><a href="#explore">Explore</a></li>
  </ul>
</nav>
</div>
</aside>

  </article>

    </main>
    <footer class="bg-white bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="center f4 fw4 hover-white no-underline black-50 dn dib-ns pv2 ph3" href="http://localhost:58150/" >
    &copy;  Will Larson 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
